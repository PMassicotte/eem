---
bibliography: /home/persican/Documents/library.bib
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

[![Travis-CI Build Status](https://travis-ci.org/PMassicotte/eemR.svg?branch=master)](https://travis-ci.org/PMassicotte/eemR)

# EEM (excitation-emission fluorescence matrix)

The **eemR** package implements various functions used calculate metrics from excitation-emission matrix (EEM) as well as to preform pre-processing corrections before PARAFAC analysis [@Bro1997; @Stedmon2005; @Murphy2013]. All functions from this package start with the `eem_` prefix. Please note this is a very alpha version of the package for testing purpose only.

```{r}
library(eem)
ls("package:eem")
```

# Reading EEMs

At the moment, only EEM csv files produced by Cary Eclipse are supported. EEM can be read using the `eem_read()` function. *Please contact me if you have other file formats you would like to add to the package*.

```{r}
library(eem)

file <- system.file("extdata/eem", "sample1.csv", package = "eem")
eem <- eem_read(file)

plot(eem)

```

# Implemented metrics

The current implemented metrics are:

1. The fluorescence index (FI) developed by @McKnight2001.
2. The Coble fluorescence peaks proposed by @Coble1996.

```{r}
library(eem)

file <- system.file("extdata/eem", "sample1.csv", package = "eem")
eem <- eem_read(file)

eem_fluorescence_index(eem)

eem_coble_peaks(eem)

```


# PARAFAC pre-processing

Three types of correction are currently supported:

1. `eem_remove_blank()` which subtract a water blank from the eem.
2. `eem_remove_scattering()` which remove both *Raman* and *Rayleigh* scattering.
3. `eem_raman_normalisation()` which normalize EEM fluoresence intensities [@Lawaetz2009].
4. `eem_inner_filter()` which correct for both primary and secondary inner-filter effect [@Ohno2002]. **TODO**

## Removing Raman and Rayleigh scattering (1st and 2nd order)

The `eem_remove_scattering()` function removes both Raman and Rayleigh scattering from EEMs.

```{r, out.width='300cm', out.height='250cm', fig.show='hold'}

file <- system.file("extdata/eem", "sample1.csv", package = "eem")
eem <- eem_read(file)

res <- eem_remove_scattering(eem = eem, type = "raman", order = 1, width = 10)
res <- eem_remove_scattering(eem = res, type = "rayleigh", order = 1, width = 10)

plot(eem)
plot(res)

```

## Blank removal

The `eem_remove_blank()` function subtract blank (miliq) water from eem.

```{r, out.width='300cm', out.height='250cm', fig.show='hold'}

file <- system.file("extdata", "nano.csv", package = "eem")
blank <- eem_read(file)

res <- eem_remove_blank(res, blank)

plot(res)
```

## Raman normalization

The `eem_raman_normalisation()` function implement a simple calibration method for fluorescence intensity using only the integrated area of a water Raman peak. More details can be found in @Lawaetz2009.

```{r, out.width='300cm', out.height='250cm', fig.show='hold'}

res <- eem_raman_normalisation(res, blank)

plot(res)

```

## Export to Matlab

PARAFAC analysis was made easy with the fantastic Matlab `drEEM` toolbox [@Murphy2013]. The function `eem_export_matlab()` can be  used to export the EEMs into a `m-file` directly usable in Matlab by the `drEEM` toolbox.


```matlab
load('OriginalData.mat')
```

# References
