---
bibliography: /home/persican/Documents/library.bib
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)

```

# EEM (excitation-emission fluorescence matrix)

The **eem** package implements various functions used calculate metrics from excitation-emission matrix (EEM) as well as to preform pre-processing corrections before PARAFAC analysis [@Bro1997; @Stedmon2005; @Murphy2013]. All functions from this package start with the `eem_` prefix.

```{r}
library(eem)
ls("package:eem")
```

At the moment, only EEM csv files produced by Cary Eclipse are supported. EEM can be read using the `eem_read()` function.

```{r}
library(eem)
eem_file <- "/home/persican/Desktop/test/eem/sn21.csv"

ex <- seq(220, 450, by = 5) ## Excitation vector of wavelengths
em <- seq(230, 600, by = 2) ## Emission vector of wavelengths

eem <- eem_read(eem_file, ex, em) ## Read the eem (csv) file

plot(eem)

```

# Implemented metrics

The current implemented metrics are:

1. The fluorescence index (FI) developped by @McKnight2001
2. The Coble fluorescence peaks proposed by @Coble1996

```{r}
library(eem)
eem_file <- "/home/persican/Desktop/test/eem/sn21.csv"

ex <- seq(220, 450, by = 5) ## Excitation vector of wavelengths
em <- seq(230, 600, by = 2) ## Emission vector of wavelengths

eem <- eem_read(eem_file, ex, em) ## Read the eem (csv) file

eem_fluorescence_index(eem)

eem_coble_peaks(eem)

```


# PARAFAC pre-processing

Three types of correction are currently supported:

1. `eem_remove_blank()` which subtract a water blank from the eem.
2. `eem_remove_scattering()` which remove both *Raman* and *Rayleigh* scattering.
3. `eem_raman_normalisation()` which normalise EEM fluoresence intensities.
4. `eem_inner_filter()` which correct [@Ohno2002] **TODO**

## `eem_remove_scattering()`

```{r, out.width='300cm', out.height='250cm', fig.show='hold'}

eem_file <- "/home/persican/Desktop/test/eem/sn21.csv"

ex <- seq(220, 450, by = 5) ## Excitation vector of wavelengths
em <- seq(230, 600, by = 2) ## Emission vector of wavelengths

eem <- eem_read(eem_file, ex, em) ## Read the eem (csv) file

res <- eem_remove_scattering(eem = eem, type = "raman", order = 1, width = 10)
res <- eem_remove_scattering(eem = res, type = "rayleigh", order = 1, width = 10)

plot(eem)
plot(res)

```

## `eem_remove_blank()`

```{r, out.width='300cm', out.height='250cm', fig.show='hold'}

mq_file <- "/home/persican/Desktop/test/nano.csv"

blank <- eem_read(mq_file, ex, em) ## Read the mq (csv) file

res <- eem_remove_blank(res, blank)

plot(res)
```

## `eem_raman_normalisation()`

```{r, out.width='300cm', out.height='250cm', fig.show='hold'}

res <- eem_raman_normalisation(res, blank)

plot(res)

```

# References
